<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<style>*{font-family: monospace;}</style>
<script>
var ciphertext = [0,0,0,0];//ENDCIPHERTEXT
</script>
</head>
<body onload="load_aes()">
	<h1>Signet Secure Document</h1>
	<p><b>You've got mail. Enter the password below to open the message.</b></p>
	<hr />
	<h2>Your Secure Message</h2>
	<p id="old_message">XXXXXX SECURED MESSAGE XXXXXX</p>
	<form action="#" onsubmit="return decrypt_message(this);">
		<p><input id="opassword" name="password" type="text" value="password" /> 
		<input value="Open" type="submit" /></p>
	</form>
	<hr />
	<h2>Write New Secure Message</h2>
	<form action="#" onsubmit="return encrypt_message(this);">
		<p><textarea id="message" name="message" rows="10" cols="100"></textarea></p>
		<p><input id="npassword" name="password" type="text" value="password" /> 
		<input value="Create Download Link" type="submit" /></p>
	</form>
	<p id="download_link"></p>
	<hr />
	<p><i>Signet is a recursive single-file browser application 
	that creates password-encrypted HTML documents with the same capabilities.</i></p>
	<p><i>Additional notes:
	</i></p><ol><i>
		<li>This application will encrypt a message into a downloadable document
		that can be shared over any communication medium. The new document has the same
		capabilities as this document.</li>
		<li>Brute forcing a password is common and simple, so only
	use Signet as a cursory measure to prevent indexing and searching of
	your data.</li>
		<li>If you are concerned about your anonymity, it is trivial to 
		add trackers to this document, so run it with the internet disconnected.</li>
		<li>If you would like to make edits to this file, do so and redistribute 
		it as you would please.</li>
	</i></ol><i>
	</i><p></p>
	<br /><br /><br />
	<input type="hidden" id="aes_data" value="CnZhciBzbG93QUVTID0gewoJLyoKCSAqIFNUQVJUIEFFUyBTRUNUSU9OCgkgKi8KCWFlczp7CgkJLy8gc3RydWN0dXJlIG9mIHZhbGlkIGtleSBzaXplcwoJCWtleVNpemU6ewoJCQlTSVpFXzEyODoxNiwKCQkJU0laRV8xOTI6MjQsCgkJCVNJWkVfMjU2OjMyCgkJfSwKCQkKCQkvLyBSaWpuZGFlbCBTLWJveAoJCXNib3g6WwoJCTB4NjMsIDB4N2MsIDB4NzcsIDB4N2IsIDB4ZjIsIDB4NmIsIDB4NmYsIDB4YzUsIDB4MzAsIDB4MDEsIDB4NjcsIDB4MmIsIDB4ZmUsIDB4ZDcsIDB4YWIsIDB4NzYsCgkJMHhjYSwgMHg4MiwgMHhjOSwgMHg3ZCwgMHhmYSwgMHg1OSwgMHg0NywgMHhmMCwgMHhhZCwgMHhkNCwgMHhhMiwgMHhhZiwgMHg5YywgMHhhNCwgMHg3MiwgMHhjMCwKCQkweGI3LCAweGZkLCAweDkzLCAweDI2LCAweDM2LCAweDNmLCAweGY3LCAweGNjLCAweDM0LCAweGE1LCAweGU1LCAweGYxLCAweDcxLCAweGQ4LCAweDMxLCAweDE1LAoJCTB4MDQsIDB4YzcsIDB4MjMsIDB4YzMsIDB4MTgsIDB4OTYsIDB4MDUsIDB4OWEsIDB4MDcsIDB4MTIsIDB4ODAsIDB4ZTIsIDB4ZWIsIDB4MjcsIDB4YjIsIDB4NzUsCgkJMHgwOSwgMHg4MywgMHgyYywgMHgxYSwgMHgxYiwgMHg2ZSwgMHg1YSwgMHhhMCwgMHg1MiwgMHgzYiwgMHhkNiwgMHhiMywgMHgyOSwgMHhlMywgMHgyZiwgMHg4NCwKCQkweDUzLCAweGQxLCAweDAwLCAweGVkLCAweDIwLCAweGZjLCAweGIxLCAweDViLCAweDZhLCAweGNiLCAweGJlLCAweDM5LCAweDRhLCAweDRjLCAweDU4LCAweGNmLAoJCTB4ZDAsIDB4ZWYsIDB4YWEsIDB4ZmIsIDB4NDMsIDB4NGQsIDB4MzMsIDB4ODUsIDB4NDUsIDB4ZjksIDB4MDIsIDB4N2YsIDB4NTAsIDB4M2MsIDB4OWYsIDB4YTgsCgkJMHg1MSwgMHhhMywgMHg0MCwgMHg4ZiwgMHg5MiwgMHg5ZCwgMHgzOCwgMHhmNSwgMHhiYywgMHhiNiwgMHhkYSwgMHgyMSwgMHgxMCwgMHhmZiwgMHhmMywgMHhkMiwKCQkweGNkLCAweDBjLCAweDEzLCAweGVjLCAweDVmLCAweDk3LCAweDQ0LCAweDE3LCAweGM0LCAweGE3LCAweDdlLCAweDNkLCAweDY0LCAweDVkLCAweDE5LCAweDczLAoJCTB4NjAsIDB4ODEsIDB4NGYsIDB4ZGMsIDB4MjIsIDB4MmEsIDB4OTAsIDB4ODgsIDB4NDYsIDB4ZWUsIDB4YjgsIDB4MTQsIDB4ZGUsIDB4NWUsIDB4MGIsIDB4ZGIsCgkJMHhlMCwgMHgzMiwgMHgzYSwgMHgwYSwgMHg0OSwgMHgwNiwgMHgyNCwgMHg1YywgMHhjMiwgMHhkMywgMHhhYywgMHg2MiwgMHg5MSwgMHg5NSwgMHhlNCwgMHg3OSwKCQkweGU3LCAweGM4LCAweDM3LCAweDZkLCAweDhkLCAweGQ1LCAweDRlLCAweGE5LCAweDZjLCAweDU2LCAweGY0LCAweGVhLCAweDY1LCAweDdhLCAweGFlLCAweDA4LAoJCTB4YmEsIDB4NzgsIDB4MjUsIDB4MmUsIDB4MWMsIDB4YTYsIDB4YjQsIDB4YzYsIDB4ZTgsIDB4ZGQsIDB4NzQsIDB4MWYsIDB4NGIsIDB4YmQsIDB4OGIsIDB4OGEsCgkJMHg3MCwgMHgzZSwgMHhiNSwgMHg2NiwgMHg0OCwgMHgwMywgMHhmNiwgMHgwZSwgMHg2MSwgMHgzNSwgMHg1NywgMHhiOSwgMHg4NiwgMHhjMSwgMHgxZCwgMHg5ZSwKCQkweGUxLCAweGY4LCAweDk4LCAweDExLCAweDY5LCAweGQ5LCAweDhlLCAweDk0LCAweDliLCAweDFlLCAweDg3LCAweGU5LCAweGNlLCAweDU1LCAweDI4LCAweGRmLAoJCTB4OGMsIDB4YTEsIDB4ODksIDB4MGQsIDB4YmYsIDB4ZTYsIDB4NDIsIDB4NjgsIDB4NDEsIDB4OTksIDB4MmQsIDB4MGYsIDB4YjAsIDB4NTQsIDB4YmIsIDB4MTYgXSwKCQkKCQkvLyBSaWpuZGFlbCBJbnZlcnRlZCBTLWJveAoJCXJzYm94OgoJCVsgMHg1MiwgMHgwOSwgMHg2YSwgMHhkNSwgMHgzMCwgMHgzNiwgMHhhNSwgMHgzOCwgMHhiZiwgMHg0MCwgMHhhMywgMHg5ZSwgMHg4MSwgMHhmMywgMHhkNywgMHhmYgoJCSwgMHg3YywgMHhlMywgMHgzOSwgMHg4MiwgMHg5YiwgMHgyZiwgMHhmZiwgMHg4NywgMHgzNCwgMHg4ZSwgMHg0MywgMHg0NCwgMHhjNCwgMHhkZSwgMHhlOSwgMHhjYgoJCSwgMHg1NCwgMHg3YiwgMHg5NCwgMHgzMiwgMHhhNiwgMHhjMiwgMHgyMywgMHgzZCwgMHhlZSwgMHg0YywgMHg5NSwgMHgwYiwgMHg0MiwgMHhmYSwgMHhjMywgMHg0ZQoJCSwgMHgwOCwgMHgyZSwgMHhhMSwgMHg2NiwgMHgyOCwgMHhkOSwgMHgyNCwgMHhiMiwgMHg3NiwgMHg1YiwgMHhhMiwgMHg0OSwgMHg2ZCwgMHg4YiwgMHhkMSwgMHgyNQoJCSwgMHg3MiwgMHhmOCwgMHhmNiwgMHg2NCwgMHg4NiwgMHg2OCwgMHg5OCwgMHgxNiwgMHhkNCwgMHhhNCwgMHg1YywgMHhjYywgMHg1ZCwgMHg2NSwgMHhiNiwgMHg5MgoJCSwgMHg2YywgMHg3MCwgMHg0OCwgMHg1MCwgMHhmZCwgMHhlZCwgMHhiOSwgMHhkYSwgMHg1ZSwgMHgxNSwgMHg0NiwgMHg1NywgMHhhNywgMHg4ZCwgMHg5ZCwgMHg4NAoJCSwgMHg5MCwgMHhkOCwgMHhhYiwgMHgwMCwgMHg4YywgMHhiYywgMHhkMywgMHgwYSwgMHhmNywgMHhlNCwgMHg1OCwgMHgwNSwgMHhiOCwgMHhiMywgMHg0NSwgMHgwNgoJCSwgMHhkMCwgMHgyYywgMHgxZSwgMHg4ZiwgMHhjYSwgMHgzZiwgMHgwZiwgMHgwMiwgMHhjMSwgMHhhZiwgMHhiZCwgMHgwMywgMHgwMSwgMHgxMywgMHg4YSwgMHg2YgoJCSwgMHgzYSwgMHg5MSwgMHgxMSwgMHg0MSwgMHg0ZiwgMHg2NywgMHhkYywgMHhlYSwgMHg5NywgMHhmMiwgMHhjZiwgMHhjZSwgMHhmMCwgMHhiNCwgMHhlNiwgMHg3MwoJCSwgMHg5NiwgMHhhYywgMHg3NCwgMHgyMiwgMHhlNywgMHhhZCwgMHgzNSwgMHg4NSwgMHhlMiwgMHhmOSwgMHgzNywgMHhlOCwgMHgxYywgMHg3NSwgMHhkZiwgMHg2ZQoJCSwgMHg0NywgMHhmMSwgMHgxYSwgMHg3MSwgMHgxZCwgMHgyOSwgMHhjNSwgMHg4OSwgMHg2ZiwgMHhiNywgMHg2MiwgMHgwZSwgMHhhYSwgMHgxOCwgMHhiZSwgMHgxYgoJCSwgMHhmYywgMHg1NiwgMHgzZSwgMHg0YiwgMHhjNiwgMHhkMiwgMHg3OSwgMHgyMCwgMHg5YSwgMHhkYiwgMHhjMCwgMHhmZSwgMHg3OCwgMHhjZCwgMHg1YSwgMHhmNAoJCSwgMHgxZiwgMHhkZCwgMHhhOCwgMHgzMywgMHg4OCwgMHgwNywgMHhjNywgMHgzMSwgMHhiMSwgMHgxMiwgMHgxMCwgMHg1OSwgMHgyNywgMHg4MCwgMHhlYywgMHg1ZgoJCSwgMHg2MCwgMHg1MSwgMHg3ZiwgMHhhOSwgMHgxOSwgMHhiNSwgMHg0YSwgMHgwZCwgMHgyZCwgMHhlNSwgMHg3YSwgMHg5ZiwgMHg5MywgMHhjOSwgMHg5YywgMHhlZgoJCSwgMHhhMCwgMHhlMCwgMHgzYiwgMHg0ZCwgMHhhZSwgMHgyYSwgMHhmNSwgMHhiMCwgMHhjOCwgMHhlYiwgMHhiYiwgMHgzYywgMHg4MywgMHg1MywgMHg5OSwgMHg2MQoJCSwgMHgxNywgMHgyYiwgMHgwNCwgMHg3ZSwgMHhiYSwgMHg3NywgMHhkNiwgMHgyNiwgMHhlMSwgMHg2OSwgMHgxNCwgMHg2MywgMHg1NSwgMHgyMSwgMHgwYywgMHg3ZCBdLAoJCQoJCS8qIHJvdGF0ZSB0aGUgd29yZCBlaWdodCBiaXRzIHRvIHRoZSBsZWZ0ICovCgkJcm90YXRlOmZ1bmN0aW9uKHdvcmQpCgkJewoJCQl2YXIgYyA9IHdvcmRbMF07CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgMzsgaSsrKQoJCQkJd29yZFtpXSA9IHdvcmRbaSsxXTsKCQkJd29yZFszXSA9IGM7CgkJCQoJCQlyZXR1cm4gd29yZDsKCQl9LAoJCQoJCS8vIFJpam5kYWVsIFJjb24KCQlSY29uOlsKCQkweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LAoJCTB4YWIsIDB4NGQsIDB4OWEsIDB4MmYsIDB4NWUsIDB4YmMsIDB4NjMsIDB4YzYsIDB4OTcsIDB4MzUsIDB4NmEsIDB4ZDQsIDB4YjMsCgkJMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwKCQkweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLAoJCTB4MDEsIDB4MDIsIDB4MDQsIDB4MDgsIDB4MTAsIDB4MjAsIDB4NDAsIDB4ODAsIDB4MWIsIDB4MzYsIDB4NmMsIDB4ZDgsIDB4YWIsCgkJMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwKCQkweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LAoJCTB4NGEsIDB4OTQsIDB4MzMsIDB4NjYsIDB4Y2MsIDB4ODMsIDB4MWQsIDB4M2EsIDB4NzQsIDB4ZTgsIDB4Y2IsIDB4OGQsIDB4MDEsCgkJMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwKCQkweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLAoJCTB4ZWYsIDB4YzUsIDB4OTEsIDB4MzksIDB4NzIsIDB4ZTQsIDB4ZDMsIDB4YmQsIDB4NjEsIDB4YzIsIDB4OWYsIDB4MjUsIDB4NGEsCgkJMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwKCQkweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLAoJCTB4MmYsIDB4NWUsIDB4YmMsIDB4NjMsIDB4YzYsIDB4OTcsIDB4MzUsIDB4NmEsIDB4ZDQsIDB4YjMsIDB4N2QsIDB4ZmEsIDB4ZWYsCgkJMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwKCQkweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LAoJCTB4MDgsIDB4MTAsIDB4MjAsIDB4NDAsIDB4ODAsIDB4MWIsIDB4MzYsIDB4NmMsIDB4ZDgsIDB4YWIsIDB4NGQsIDB4OWEsIDB4MmYsCgkJMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwKCQkweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLAoJCTB4NjYsIDB4Y2MsIDB4ODMsIDB4MWQsIDB4M2EsIDB4NzQsIDB4ZTgsIDB4Y2IgXSwKCgkJRzJYOiBbCgkJMHgwMCwgMHgwMiwgMHgwNCwgMHgwNiwgMHgwOCwgMHgwYSwgMHgwYywgMHgwZSwgMHgxMCwgMHgxMiwgMHgxNCwgMHgxNiwKCQkweDE4LCAweDFhLCAweDFjLCAweDFlLCAweDIwLCAweDIyLCAweDI0LCAweDI2LCAweDI4LCAweDJhLCAweDJjLCAweDJlLAoJCTB4MzAsIDB4MzIsIDB4MzQsIDB4MzYsIDB4MzgsIDB4M2EsIDB4M2MsIDB4M2UsIDB4NDAsIDB4NDIsIDB4NDQsIDB4NDYsCgkJMHg0OCwgMHg0YSwgMHg0YywgMHg0ZSwgMHg1MCwgMHg1MiwgMHg1NCwgMHg1NiwgMHg1OCwgMHg1YSwgMHg1YywgMHg1ZSwKCQkweDYwLCAweDYyLCAweDY0LCAweDY2LCAweDY4LCAweDZhLCAweDZjLCAweDZlLCAweDcwLCAweDcyLCAweDc0LCAweDc2LAoJCTB4NzgsIDB4N2EsIDB4N2MsIDB4N2UsIDB4ODAsIDB4ODIsIDB4ODQsIDB4ODYsIDB4ODgsIDB4OGEsIDB4OGMsIDB4OGUsCgkJMHg5MCwgMHg5MiwgMHg5NCwgMHg5NiwgMHg5OCwgMHg5YSwgMHg5YywgMHg5ZSwgMHhhMCwgMHhhMiwgMHhhNCwgMHhhNiwKCQkweGE4LCAweGFhLCAweGFjLCAweGFlLCAweGIwLCAweGIyLCAweGI0LCAweGI2LCAweGI4LCAweGJhLCAweGJjLCAweGJlLAoJCTB4YzAsIDB4YzIsIDB4YzQsIDB4YzYsIDB4YzgsIDB4Y2EsIDB4Y2MsIDB4Y2UsIDB4ZDAsIDB4ZDIsIDB4ZDQsIDB4ZDYsCgkJMHhkOCwgMHhkYSwgMHhkYywgMHhkZSwgMHhlMCwgMHhlMiwgMHhlNCwgMHhlNiwgMHhlOCwgMHhlYSwgMHhlYywgMHhlZSwKCQkweGYwLCAweGYyLCAweGY0LCAweGY2LCAweGY4LCAweGZhLCAweGZjLCAweGZlLCAweDFiLCAweDE5LCAweDFmLCAweDFkLAoJCTB4MTMsIDB4MTEsIDB4MTcsIDB4MTUsIDB4MGIsIDB4MDksIDB4MGYsIDB4MGQsIDB4MDMsIDB4MDEsIDB4MDcsIDB4MDUsCgkJMHgzYiwgMHgzOSwgMHgzZiwgMHgzZCwgMHgzMywgMHgzMSwgMHgzNywgMHgzNSwgMHgyYiwgMHgyOSwgMHgyZiwgMHgyZCwKCQkweDIzLCAweDIxLCAweDI3LCAweDI1LCAweDViLCAweDU5LCAweDVmLCAweDVkLCAweDUzLCAweDUxLCAweDU3LCAweDU1LAoJCTB4NGIsIDB4NDksIDB4NGYsIDB4NGQsIDB4NDMsIDB4NDEsIDB4NDcsIDB4NDUsIDB4N2IsIDB4NzksIDB4N2YsIDB4N2QsCgkJMHg3MywgMHg3MSwgMHg3NywgMHg3NSwgMHg2YiwgMHg2OSwgMHg2ZiwgMHg2ZCwgMHg2MywgMHg2MSwgMHg2NywgMHg2NSwKCQkweDliLCAweDk5LCAweDlmLCAweDlkLCAweDkzLCAweDkxLCAweDk3LCAweDk1LCAweDhiLCAweDg5LCAweDhmLCAweDhkLAoJCTB4ODMsIDB4ODEsIDB4ODcsIDB4ODUsIDB4YmIsIDB4YjksIDB4YmYsIDB4YmQsIDB4YjMsIDB4YjEsIDB4YjcsIDB4YjUsCgkJMHhhYiwgMHhhOSwgMHhhZiwgMHhhZCwgMHhhMywgMHhhMSwgMHhhNywgMHhhNSwgMHhkYiwgMHhkOSwgMHhkZiwgMHhkZCwKCQkweGQzLCAweGQxLCAweGQ3LCAweGQ1LCAweGNiLCAweGM5LCAweGNmLCAweGNkLCAweGMzLCAweGMxLCAweGM3LCAweGM1LAoJCTB4ZmIsIDB4ZjksIDB4ZmYsIDB4ZmQsIDB4ZjMsIDB4ZjEsIDB4ZjcsIDB4ZjUsIDB4ZWIsIDB4ZTksIDB4ZWYsIDB4ZWQsCgkJMHhlMywgMHhlMSwgMHhlNywgMHhlNQoJCV0sCgoJCUczWDogWwoJCTB4MDAsIDB4MDMsIDB4MDYsIDB4MDUsIDB4MGMsIDB4MGYsIDB4MGEsIDB4MDksIDB4MTgsIDB4MWIsIDB4MWUsIDB4MWQsCgkJMHgxNCwgMHgxNywgMHgxMiwgMHgxMSwgMHgzMCwgMHgzMywgMHgzNiwgMHgzNSwgMHgzYywgMHgzZiwgMHgzYSwgMHgzOSwKCQkweDI4LCAweDJiLCAweDJlLCAweDJkLCAweDI0LCAweDI3LCAweDIyLCAweDIxLCAweDYwLCAweDYzLCAweDY2LCAweDY1LAoJCTB4NmMsIDB4NmYsIDB4NmEsIDB4NjksIDB4NzgsIDB4N2IsIDB4N2UsIDB4N2QsIDB4NzQsIDB4NzcsIDB4NzIsIDB4NzEsCgkJMHg1MCwgMHg1MywgMHg1NiwgMHg1NSwgMHg1YywgMHg1ZiwgMHg1YSwgMHg1OSwgMHg0OCwgMHg0YiwgMHg0ZSwgMHg0ZCwKCQkweDQ0LCAweDQ3LCAweDQyLCAweDQxLCAweGMwLCAweGMzLCAweGM2LCAweGM1LCAweGNjLCAweGNmLCAweGNhLCAweGM5LAoJCTB4ZDgsIDB4ZGIsIDB4ZGUsIDB4ZGQsIDB4ZDQsIDB4ZDcsIDB4ZDIsIDB4ZDEsIDB4ZjAsIDB4ZjMsIDB4ZjYsIDB4ZjUsCgkJMHhmYywgMHhmZiwgMHhmYSwgMHhmOSwgMHhlOCwgMHhlYiwgMHhlZSwgMHhlZCwgMHhlNCwgMHhlNywgMHhlMiwgMHhlMSwKCQkweGEwLCAweGEzLCAweGE2LCAweGE1LCAweGFjLCAweGFmLCAweGFhLCAweGE5LCAweGI4LCAweGJiLCAweGJlLCAweGJkLAoJCTB4YjQsIDB4YjcsIDB4YjIsIDB4YjEsIDB4OTAsIDB4OTMsIDB4OTYsIDB4OTUsIDB4OWMsIDB4OWYsIDB4OWEsIDB4OTksCgkJMHg4OCwgMHg4YiwgMHg4ZSwgMHg4ZCwgMHg4NCwgMHg4NywgMHg4MiwgMHg4MSwgMHg5YiwgMHg5OCwgMHg5ZCwgMHg5ZSwKCQkweDk3LCAweDk0LCAweDkxLCAweDkyLCAweDgzLCAweDgwLCAweDg1LCAweDg2LCAweDhmLCAweDhjLCAweDg5LCAweDhhLAoJCTB4YWIsIDB4YTgsIDB4YWQsIDB4YWUsIDB4YTcsIDB4YTQsIDB4YTEsIDB4YTIsIDB4YjMsIDB4YjAsIDB4YjUsIDB4YjYsCgkJMHhiZiwgMHhiYywgMHhiOSwgMHhiYSwgMHhmYiwgMHhmOCwgMHhmZCwgMHhmZSwgMHhmNywgMHhmNCwgMHhmMSwgMHhmMiwKCQkweGUzLCAweGUwLCAweGU1LCAweGU2LCAweGVmLCAweGVjLCAweGU5LCAweGVhLCAweGNiLCAweGM4LCAweGNkLCAweGNlLAoJCTB4YzcsIDB4YzQsIDB4YzEsIDB4YzIsIDB4ZDMsIDB4ZDAsIDB4ZDUsIDB4ZDYsIDB4ZGYsIDB4ZGMsIDB4ZDksIDB4ZGEsCgkJMHg1YiwgMHg1OCwgMHg1ZCwgMHg1ZSwgMHg1NywgMHg1NCwgMHg1MSwgMHg1MiwgMHg0MywgMHg0MCwgMHg0NSwgMHg0NiwKCQkweDRmLCAweDRjLCAweDQ5LCAweDRhLCAweDZiLCAweDY4LCAweDZkLCAweDZlLCAweDY3LCAweDY0LCAweDYxLCAweDYyLAoJCTB4NzMsIDB4NzAsIDB4NzUsIDB4NzYsIDB4N2YsIDB4N2MsIDB4NzksIDB4N2EsIDB4M2IsIDB4MzgsIDB4M2QsIDB4M2UsCgkJMHgzNywgMHgzNCwgMHgzMSwgMHgzMiwgMHgyMywgMHgyMCwgMHgyNSwgMHgyNiwgMHgyZiwgMHgyYywgMHgyOSwgMHgyYSwKCQkweDBiLCAweDA4LCAweDBkLCAweDBlLCAweDA3LCAweDA0LCAweDAxLCAweDAyLCAweDEzLCAweDEwLCAweDE1LCAweDE2LAoJCTB4MWYsIDB4MWMsIDB4MTksIDB4MWEKCQldLAoKCQlHOVg6IFsKCQkweDAwLCAweDA5LCAweDEyLCAweDFiLCAweDI0LCAweDJkLCAweDM2LCAweDNmLCAweDQ4LCAweDQxLCAweDVhLCAweDUzLAoJCTB4NmMsIDB4NjUsIDB4N2UsIDB4NzcsIDB4OTAsIDB4OTksIDB4ODIsIDB4OGIsIDB4YjQsIDB4YmQsIDB4YTYsIDB4YWYsCgkJMHhkOCwgMHhkMSwgMHhjYSwgMHhjMywgMHhmYywgMHhmNSwgMHhlZSwgMHhlNywgMHgzYiwgMHgzMiwgMHgyOSwgMHgyMCwKCQkweDFmLCAweDE2LCAweDBkLCAweDA0LCAweDczLCAweDdhLCAweDYxLCAweDY4LCAweDU3LCAweDVlLCAweDQ1LCAweDRjLAoJCTB4YWIsIDB4YTIsIDB4YjksIDB4YjAsIDB4OGYsIDB4ODYsIDB4OWQsIDB4OTQsIDB4ZTMsIDB4ZWEsIDB4ZjEsIDB4ZjgsCgkJMHhjNywgMHhjZSwgMHhkNSwgMHhkYywgMHg3NiwgMHg3ZiwgMHg2NCwgMHg2ZCwgMHg1MiwgMHg1YiwgMHg0MCwgMHg0OSwKCQkweDNlLCAweDM3LCAweDJjLCAweDI1LCAweDFhLCAweDEzLCAweDA4LCAweDAxLCAweGU2LCAweGVmLCAweGY0LCAweGZkLAoJCTB4YzIsIDB4Y2IsIDB4ZDAsIDB4ZDksIDB4YWUsIDB4YTcsIDB4YmMsIDB4YjUsIDB4OGEsIDB4ODMsIDB4OTgsIDB4OTEsCgkJMHg0ZCwgMHg0NCwgMHg1ZiwgMHg1NiwgMHg2OSwgMHg2MCwgMHg3YiwgMHg3MiwgMHgwNSwgMHgwYywgMHgxNywgMHgxZSwKCQkweDIxLCAweDI4LCAweDMzLCAweDNhLCAweGRkLCAweGQ0LCAweGNmLCAweGM2LCAweGY5LCAweGYwLCAweGViLCAweGUyLAoJCTB4OTUsIDB4OWMsIDB4ODcsIDB4OGUsIDB4YjEsIDB4YjgsIDB4YTMsIDB4YWEsIDB4ZWMsIDB4ZTUsIDB4ZmUsIDB4ZjcsCgkJMHhjOCwgMHhjMSwgMHhkYSwgMHhkMywgMHhhNCwgMHhhZCwgMHhiNiwgMHhiZiwgMHg4MCwgMHg4OSwgMHg5MiwgMHg5YiwKCQkweDdjLCAweDc1LCAweDZlLCAweDY3LCAweDU4LCAweDUxLCAweDRhLCAweDQzLCAweDM0LCAweDNkLCAweDI2LCAweDJmLAoJCTB4MTAsIDB4MTksIDB4MDIsIDB4MGIsIDB4ZDcsIDB4ZGUsIDB4YzUsIDB4Y2MsIDB4ZjMsIDB4ZmEsIDB4ZTEsIDB4ZTgsCgkJMHg5ZiwgMHg5NiwgMHg4ZCwgMHg4NCwgMHhiYiwgMHhiMiwgMHhhOSwgMHhhMCwgMHg0NywgMHg0ZSwgMHg1NSwgMHg1YywKCQkweDYzLCAweDZhLCAweDcxLCAweDc4LCAweDBmLCAweDA2LCAweDFkLCAweDE0LCAweDJiLCAweDIyLCAweDM5LCAweDMwLAoJCTB4OWEsIDB4OTMsIDB4ODgsIDB4ODEsIDB4YmUsIDB4YjcsIDB4YWMsIDB4YTUsIDB4ZDIsIDB4ZGIsIDB4YzAsIDB4YzksCgkJMHhmNiwgMHhmZiwgMHhlNCwgMHhlZCwgMHgwYSwgMHgwMywgMHgxOCwgMHgxMSwgMHgyZSwgMHgyNywgMHgzYywgMHgzNSwKCQkweDQyLCAweDRiLCAweDUwLCAweDU5LCAweDY2LCAweDZmLCAweDc0LCAweDdkLCAweGExLCAweGE4LCAweGIzLCAweGJhLAoJCTB4ODUsIDB4OGMsIDB4OTcsIDB4OWUsIDB4ZTksIDB4ZTAsIDB4ZmIsIDB4ZjIsIDB4Y2QsIDB4YzQsIDB4ZGYsIDB4ZDYsCgkJMHgzMSwgMHgzOCwgMHgyMywgMHgyYSwgMHgxNSwgMHgxYywgMHgwNywgMHgwZSwgMHg3OSwgMHg3MCwgMHg2YiwgMHg2MiwKCQkweDVkLCAweDU0LCAweDRmLCAweDQ2CgkJXSwKCgkJR0JYOiBbCgkJMHgwMCwgMHgwYiwgMHgxNiwgMHgxZCwgMHgyYywgMHgyNywgMHgzYSwgMHgzMSwgMHg1OCwgMHg1MywgMHg0ZSwgMHg0NSwKCQkweDc0LCAweDdmLCAweDYyLCAweDY5LCAweGIwLCAweGJiLCAweGE2LCAweGFkLCAweDljLCAweDk3LCAweDhhLCAweDgxLAoJCTB4ZTgsIDB4ZTMsIDB4ZmUsIDB4ZjUsIDB4YzQsIDB4Y2YsIDB4ZDIsIDB4ZDksIDB4N2IsIDB4NzAsIDB4NmQsIDB4NjYsCgkJMHg1NywgMHg1YywgMHg0MSwgMHg0YSwgMHgyMywgMHgyOCwgMHgzNSwgMHgzZSwgMHgwZiwgMHgwNCwgMHgxOSwgMHgxMiwKCQkweGNiLCAweGMwLCAweGRkLCAweGQ2LCAweGU3LCAweGVjLCAweGYxLCAweGZhLCAweDkzLCAweDk4LCAweDg1LCAweDhlLAoJCTB4YmYsIDB4YjQsIDB4YTksIDB4YTIsIDB4ZjYsIDB4ZmQsIDB4ZTAsIDB4ZWIsIDB4ZGEsIDB4ZDEsIDB4Y2MsIDB4YzcsCgkJMHhhZSwgMHhhNSwgMHhiOCwgMHhiMywgMHg4MiwgMHg4OSwgMHg5NCwgMHg5ZiwgMHg0NiwgMHg0ZCwgMHg1MCwgMHg1YiwKCQkweDZhLCAweDYxLCAweDdjLCAweDc3LCAweDFlLCAweDE1LCAweDA4LCAweDAzLCAweDMyLCAweDM5LCAweDI0LCAweDJmLAoJCTB4OGQsIDB4ODYsIDB4OWIsIDB4OTAsIDB4YTEsIDB4YWEsIDB4YjcsIDB4YmMsIDB4ZDUsIDB4ZGUsIDB4YzMsIDB4YzgsCgkJMHhmOSwgMHhmMiwgMHhlZiwgMHhlNCwgMHgzZCwgMHgzNiwgMHgyYiwgMHgyMCwgMHgxMSwgMHgxYSwgMHgwNywgMHgwYywKCQkweDY1LCAweDZlLCAweDczLCAweDc4LCAweDQ5LCAweDQyLCAweDVmLCAweDU0LCAweGY3LCAweGZjLCAweGUxLCAweGVhLAoJCTB4ZGIsIDB4ZDAsIDB4Y2QsIDB4YzYsIDB4YWYsIDB4YTQsIDB4YjksIDB4YjIsIDB4ODMsIDB4ODgsIDB4OTUsIDB4OWUsCgkJMHg0NywgMHg0YywgMHg1MSwgMHg1YSwgMHg2YiwgMHg2MCwgMHg3ZCwgMHg3NiwgMHgxZiwgMHgxNCwgMHgwOSwgMHgwMiwKCQkweDMzLCAweDM4LCAweDI1LCAweDJlLCAweDhjLCAweDg3LCAweDlhLCAweDkxLCAweGEwLCAweGFiLCAweGI2LCAweGJkLAoJCTB4ZDQsIDB4ZGYsIDB4YzIsIDB4YzksIDB4ZjgsIDB4ZjMsIDB4ZWUsIDB4ZTUsIDB4M2MsIDB4MzcsIDB4MmEsIDB4MjEsCgkJMHgxMCwgMHgxYiwgMHgwNiwgMHgwZCwgMHg2NCwgMHg2ZiwgMHg3MiwgMHg3OSwgMHg0OCwgMHg0MywgMHg1ZSwgMHg1NSwKCQkweDAxLCAweDBhLCAweDE3LCAweDFjLCAweDJkLCAweDI2LCAweDNiLCAweDMwLCAweDU5LCAweDUyLCAweDRmLCAweDQ0LAoJCTB4NzUsIDB4N2UsIDB4NjMsIDB4NjgsIDB4YjEsIDB4YmEsIDB4YTcsIDB4YWMsIDB4OWQsIDB4OTYsIDB4OGIsIDB4ODAsCgkJMHhlOSwgMHhlMiwgMHhmZiwgMHhmNCwgMHhjNSwgMHhjZSwgMHhkMywgMHhkOCwgMHg3YSwgMHg3MSwgMHg2YywgMHg2NywKCQkweDU2LCAweDVkLCAweDQwLCAweDRiLCAweDIyLCAweDI5LCAweDM0LCAweDNmLCAweDBlLCAweDA1LCAweDE4LCAweDEzLAoJCTB4Y2EsIDB4YzEsIDB4ZGMsIDB4ZDcsIDB4ZTYsIDB4ZWQsIDB4ZjAsIDB4ZmIsIDB4OTIsIDB4OTksIDB4ODQsIDB4OGYsCgkJMHhiZSwgMHhiNSwgMHhhOCwgMHhhMwoJCV0sCgoJCUdEWDogWwoJCTB4MDAsIDB4MGQsIDB4MWEsIDB4MTcsIDB4MzQsIDB4MzksIDB4MmUsIDB4MjMsIDB4NjgsIDB4NjUsIDB4NzIsIDB4N2YsCgkJMHg1YywgMHg1MSwgMHg0NiwgMHg0YiwgMHhkMCwgMHhkZCwgMHhjYSwgMHhjNywgMHhlNCwgMHhlOSwgMHhmZSwgMHhmMywKCQkweGI4LCAweGI1LCAweGEyLCAweGFmLCAweDhjLCAweDgxLCAweDk2LCAweDliLCAweGJiLCAweGI2LCAweGExLCAweGFjLAoJCTB4OGYsIDB4ODIsIDB4OTUsIDB4OTgsIDB4ZDMsIDB4ZGUsIDB4YzksIDB4YzQsIDB4ZTcsIDB4ZWEsIDB4ZmQsIDB4ZjAsCgkJMHg2YiwgMHg2NiwgMHg3MSwgMHg3YywgMHg1ZiwgMHg1MiwgMHg0NSwgMHg0OCwgMHgwMywgMHgwZSwgMHgxOSwgMHgxNCwKCQkweDM3LCAweDNhLCAweDJkLCAweDIwLCAweDZkLCAweDYwLCAweDc3LCAweDdhLCAweDU5LCAweDU0LCAweDQzLCAweDRlLAoJCTB4MDUsIDB4MDgsIDB4MWYsIDB4MTIsIDB4MzEsIDB4M2MsIDB4MmIsIDB4MjYsIDB4YmQsIDB4YjAsIDB4YTcsIDB4YWEsCgkJMHg4OSwgMHg4NCwgMHg5MywgMHg5ZSwgMHhkNSwgMHhkOCwgMHhjZiwgMHhjMiwgMHhlMSwgMHhlYywgMHhmYiwgMHhmNiwKCQkweGQ2LCAweGRiLCAweGNjLCAweGMxLCAweGUyLCAweGVmLCAweGY4LCAweGY1LCAweGJlLCAweGIzLCAweGE0LCAweGE5LAoJCTB4OGEsIDB4ODcsIDB4OTAsIDB4OWQsIDB4MDYsIDB4MGIsIDB4MWMsIDB4MTEsIDB4MzIsIDB4M2YsIDB4MjgsIDB4MjUsCgkJMHg2ZSwgMHg2MywgMHg3NCwgMHg3OSwgMHg1YSwgMHg1NywgMHg0MCwgMHg0ZCwgMHhkYSwgMHhkNywgMHhjMCwgMHhjZCwKCQkweGVlLCAweGUzLCAweGY0LCAweGY5LCAweGIyLCAweGJmLCAweGE4LCAweGE1LCAweDg2LCAweDhiLCAweDljLCAweDkxLAoJCTB4MGEsIDB4MDcsIDB4MTAsIDB4MWQsIDB4M2UsIDB4MzMsIDB4MjQsIDB4MjksIDB4NjIsIDB4NmYsIDB4NzgsIDB4NzUsCgkJMHg1NiwgMHg1YiwgMHg0YywgMHg0MSwgMHg2MSwgMHg2YywgMHg3YiwgMHg3NiwgMHg1NSwgMHg1OCwgMHg0ZiwgMHg0MiwKCQkweDA5LCAweDA0LCAweDEzLCAweDFlLCAweDNkLCAweDMwLCAweDI3LCAweDJhLCAweGIxLCAweGJjLCAweGFiLCAweGE2LAoJCTB4ODUsIDB4ODgsIDB4OWYsIDB4OTIsIDB4ZDksIDB4ZDQsIDB4YzMsIDB4Y2UsIDB4ZWQsIDB4ZTAsIDB4ZjcsIDB4ZmEsCgkJMHhiNywgMHhiYSwgMHhhZCwgMHhhMCwgMHg4MywgMHg4ZSwgMHg5OSwgMHg5NCwgMHhkZiwgMHhkMiwgMHhjNSwgMHhjOCwKCQkweGViLCAweGU2LCAweGYxLCAweGZjLCAweDY3LCAweDZhLCAweDdkLCAweDcwLCAweDUzLCAweDVlLCAweDQ5LCAweDQ0LAoJCTB4MGYsIDB4MDIsIDB4MTUsIDB4MTgsIDB4M2IsIDB4MzYsIDB4MjEsIDB4MmMsIDB4MGMsIDB4MDEsIDB4MTYsIDB4MWIsCgkJMHgzOCwgMHgzNSwgMHgyMiwgMHgyZiwgMHg2NCwgMHg2OSwgMHg3ZSwgMHg3MywgMHg1MCwgMHg1ZCwgMHg0YSwgMHg0NywKCQkweGRjLCAweGQxLCAweGM2LCAweGNiLCAweGU4LCAweGU1LCAweGYyLCAweGZmLCAweGI0LCAweGI5LCAweGFlLCAweGEzLAoJCTB4ODAsIDB4OGQsIDB4OWEsIDB4OTcKCQldLAoKCQlHRVg6IFsKCQkweDAwLCAweDBlLCAweDFjLCAweDEyLCAweDM4LCAweDM2LCAweDI0LCAweDJhLCAweDcwLCAweDdlLCAweDZjLCAweDYyLAoJCTB4NDgsIDB4NDYsIDB4NTQsIDB4NWEsIDB4ZTAsIDB4ZWUsIDB4ZmMsIDB4ZjIsIDB4ZDgsIDB4ZDYsIDB4YzQsIDB4Y2EsCgkJMHg5MCwgMHg5ZSwgMHg4YywgMHg4MiwgMHhhOCwgMHhhNiwgMHhiNCwgMHhiYSwgMHhkYiwgMHhkNSwgMHhjNywgMHhjOSwKCQkweGUzLCAweGVkLCAweGZmLCAweGYxLCAweGFiLCAweGE1LCAweGI3LCAweGI5LCAweDkzLCAweDlkLCAweDhmLCAweDgxLAoJCTB4M2IsIDB4MzUsIDB4MjcsIDB4MjksIDB4MDMsIDB4MGQsIDB4MWYsIDB4MTEsIDB4NGIsIDB4NDUsIDB4NTcsIDB4NTksCgkJMHg3MywgMHg3ZCwgMHg2ZiwgMHg2MSwgMHhhZCwgMHhhMywgMHhiMSwgMHhiZiwgMHg5NSwgMHg5YiwgMHg4OSwgMHg4NywKCQkweGRkLCAweGQzLCAweGMxLCAweGNmLCAweGU1LCAweGViLCAweGY5LCAweGY3LCAweDRkLCAweDQzLCAweDUxLCAweDVmLAoJCTB4NzUsIDB4N2IsIDB4NjksIDB4NjcsIDB4M2QsIDB4MzMsIDB4MjEsIDB4MmYsIDB4MDUsIDB4MGIsIDB4MTksIDB4MTcsCgkJMHg3NiwgMHg3OCwgMHg2YSwgMHg2NCwgMHg0ZSwgMHg0MCwgMHg1MiwgMHg1YywgMHgwNiwgMHgwOCwgMHgxYSwgMHgxNCwKCQkweDNlLCAweDMwLCAweDIyLCAweDJjLCAweDk2LCAweDk4LCAweDhhLCAweDg0LCAweGFlLCAweGEwLCAweGIyLCAweGJjLAoJCTB4ZTYsIDB4ZTgsIDB4ZmEsIDB4ZjQsIDB4ZGUsIDB4ZDAsIDB4YzIsIDB4Y2MsIDB4NDEsIDB4NGYsIDB4NWQsIDB4NTMsCgkJMHg3OSwgMHg3NywgMHg2NSwgMHg2YiwgMHgzMSwgMHgzZiwgMHgyZCwgMHgyMywgMHgwOSwgMHgwNywgMHgxNSwgMHgxYiwKCQkweGExLCAweGFmLCAweGJkLCAweGIzLCAweDk5LCAweDk3LCAweDg1LCAweDhiLCAweGQxLCAweGRmLCAweGNkLCAweGMzLAoJCTB4ZTksIDB4ZTcsIDB4ZjUsIDB4ZmIsIDB4OWEsIDB4OTQsIDB4ODYsIDB4ODgsIDB4YTIsIDB4YWMsIDB4YmUsIDB4YjAsCgkJMHhlYSwgMHhlNCwgMHhmNiwgMHhmOCwgMHhkMiwgMHhkYywgMHhjZSwgMHhjMCwgMHg3YSwgMHg3NCwgMHg2NiwgMHg2OCwKCQkweDQyLCAweDRjLCAweDVlLCAweDUwLCAweDBhLCAweDA0LCAweDE2LCAweDE4LCAweDMyLCAweDNjLCAweDJlLCAweDIwLAoJCTB4ZWMsIDB4ZTIsIDB4ZjAsIDB4ZmUsIDB4ZDQsIDB4ZGEsIDB4YzgsIDB4YzYsIDB4OWMsIDB4OTIsIDB4ODAsIDB4OGUsCgkJMHhhNCwgMHhhYSwgMHhiOCwgMHhiNiwgMHgwYywgMHgwMiwgMHgxMCwgMHgxZSwgMHgzNCwgMHgzYSwgMHgyOCwgMHgyNiwKCQkweDdjLCAweDcyLCAweDYwLCAweDZlLCAweDQ0LCAweDRhLCAweDU4LCAweDU2LCAweDM3LCAweDM5LCAweDJiLCAweDI1LAoJCTB4MGYsIDB4MDEsIDB4MTMsIDB4MWQsIDB4NDcsIDB4NDksIDB4NWIsIDB4NTUsIDB4N2YsIDB4NzEsIDB4NjMsIDB4NmQsCgkJMHhkNywgMHhkOSwgMHhjYiwgMHhjNSwgMHhlZiwgMHhlMSwgMHhmMywgMHhmZCwgMHhhNywgMHhhOSwgMHhiYiwgMHhiNSwKCQkweDlmLCAweDkxLCAweDgzLCAweDhkCgkJXSwKCQkKCQkvLyBLZXkgU2NoZWR1bGUgQ29yZQoJCWNvcmU6ZnVuY3Rpb24od29yZCxpdGVyYXRpb24pCgkJewoJCQkvKiByb3RhdGUgdGhlIDMyLWJpdCB3b3JkIDggYml0cyB0byB0aGUgbGVmdCAqLwoJCQl3b3JkID0gdGhpcy5yb3RhdGUod29yZCk7CgkJCS8qIGFwcGx5IFMtQm94IHN1YnN0aXR1dGlvbiBvbiBhbGwgNCBwYXJ0cyBvZiB0aGUgMzItYml0IHdvcmQgKi8KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCA0OyArK2kpCgkJCQl3b3JkW2ldID0gdGhpcy5zYm94W3dvcmRbaV1dOwoJCQkvKiBYT1IgdGhlIG91dHB1dCBvZiB0aGUgcmNvbiBvcGVyYXRpb24gd2l0aCBpIHRvIHRoZSBmaXJzdCBwYXJ0IChsZWZ0bW9zdCkgb25seSAqLwoJCQl3b3JkWzBdID0gd29yZFswXV50aGlzLlJjb25baXRlcmF0aW9uXTsKCQkJcmV0dXJuIHdvcmQ7CgkJfSwKCQkKCQkvKiBSaWpuZGFlbCdzIGtleSBleHBhbnNpb24KCQkgKiBleHBhbmRzIGFuIDEyOCwxOTIsMjU2IGtleSBpbnRvIGFuIDE3NiwyMDgsMjQwIGJ5dGVzIGtleQoJCSAqCgkJICogZXhwYW5kZWRLZXkgaXMgYSBwb2ludGVyIHRvIGFuIGNoYXIgYXJyYXkgb2YgbGFyZ2UgZW5vdWdoIHNpemUKCQkgKiBrZXkgaXMgYSBwb2ludGVyIHRvIGEgbm9uLWV4cGFuZGVkIGtleQoJCSAqLwoJCWV4cGFuZEtleTpmdW5jdGlvbihrZXksc2l6ZSkKCQl7CgkJCXZhciBleHBhbmRlZEtleVNpemUgPSAoMTYqKHRoaXMubnVtYmVyT2ZSb3VuZHMoc2l6ZSkrMSkpOwoJCQkKCQkJLyogY3VycmVudCBleHBhbmRlZCBrZXlTaXplLCBpbiBieXRlcyAqLwoJCQl2YXIgY3VycmVudFNpemUgPSAwOwoJCQl2YXIgcmNvbkl0ZXJhdGlvbiA9IDE7CgkJCXZhciB0ID0gW107ICAgLy8gdGVtcG9yYXJ5IDQtYnl0ZSB2YXJpYWJsZQoJCQkKCQkJdmFyIGV4cGFuZGVkS2V5ID0gW107CgkJCWZvcih2YXIgaSA9IDA7aSA8IGV4cGFuZGVkS2V5U2l6ZTtpKyspCgkJCQlleHBhbmRlZEtleVtpXSA9IDA7CgkJCgkJCS8qIHNldCB0aGUgMTYsMjQsMzIgYnl0ZXMgb2YgdGhlIGV4cGFuZGVkIGtleSB0byB0aGUgaW5wdXQga2V5ICovCgkJCWZvciAodmFyIGogPSAwOyBqIDwgc2l6ZTsgaisrKQoJCQkJZXhwYW5kZWRLZXlbal0gPSBrZXlbal07CgkJCWN1cnJlbnRTaXplICs9IHNpemU7CgkJCgkJCXdoaWxlIChjdXJyZW50U2l6ZSA8IGV4cGFuZGVkS2V5U2l6ZSkKCQkJewoJCQkJLyogYXNzaWduIHRoZSBwcmV2aW91cyA0IGJ5dGVzIHRvIHRoZSB0ZW1wb3JhcnkgdmFsdWUgdCAqLwoJCQkJZm9yICh2YXIgayA9IDA7IGsgPCA0OyBrKyspCgkJCQkJdFtrXSA9IGV4cGFuZGVkS2V5WyhjdXJyZW50U2l6ZSAtIDQpICsga107CgkJCgkJCQkvKiBldmVyeSAxNiwyNCwzMiBieXRlcyB3ZSBhcHBseSB0aGUgY29yZSBzY2hlZHVsZSB0byB0CgkJCQkgKiBhbmQgaW5jcmVtZW50IHJjb25JdGVyYXRpb24gYWZ0ZXJ3YXJkcwoJCQkJICovCgkJCQlpZihjdXJyZW50U2l6ZSAlIHNpemUgPT0gMCkKCQkJCQl0ID0gdGhpcy5jb3JlKHQsIHJjb25JdGVyYXRpb24rKyk7CgkJCgkJCQkvKiBGb3IgMjU2LWJpdCBrZXlzLCB3ZSBhZGQgYW4gZXh0cmEgc2JveCB0byB0aGUgY2FsY3VsYXRpb24gKi8KCQkJCWlmKHNpemUgPT0gdGhpcy5rZXlTaXplLlNJWkVfMjU2ICYmICgoY3VycmVudFNpemUgJSBzaXplKSA9PSAxNikpCgkJCQkJZm9yKHZhciBsID0gMDsgbCA8IDQ7IGwrKykKCQkJCQkJdFtsXSA9IHRoaXMuc2JveFt0W2xdXTsKCQkKCQkJCS8qIFdlIFhPUiB0IHdpdGggdGhlIGZvdXItYnl0ZSBibG9jayAxNiwyNCwzMiBieXRlcyBiZWZvcmUgdGhlIG5ldyBleHBhbmRlZCBrZXkuCgkJCQkgKiBUaGlzIGJlY29tZXMgdGhlIG5leHQgZm91ciBieXRlcyBpbiB0aGUgZXhwYW5kZWQga2V5LgoJCQkJICovCgkJCQlmb3IodmFyIG0gPSAwOyBtIDwgNDsgbSsrKSB7CgkJCQkJZXhwYW5kZWRLZXlbY3VycmVudFNpemVdID0gZXhwYW5kZWRLZXlbY3VycmVudFNpemUgLSBzaXplXSBeIHRbbV07CgkJCQkJY3VycmVudFNpemUrKzsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZXhwYW5kZWRLZXk7CgkJfSwKCQkKCQkvLyBBZGRzIChYT1JzKSB0aGUgcm91bmQga2V5IHRvIHRoZSBzdGF0ZQoJCWFkZFJvdW5kS2V5OmZ1bmN0aW9uKHN0YXRlLHJvdW5kS2V5KQoJCXsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCAxNjsgaSsrKQoJCQkJc3RhdGVbaV0gXj0gcm91bmRLZXlbaV07CgkJCXJldHVybiBzdGF0ZTsKCQl9LAoJCQoJCS8vIENyZWF0ZXMgYSByb3VuZCBrZXkgZnJvbSB0aGUgZ2l2ZW4gZXhwYW5kZWQga2V5IGFuZCB0aGUKCQkvLyBwb3NpdGlvbiB3aXRoaW4gdGhlIGV4cGFuZGVkIGtleS4KCQljcmVhdGVSb3VuZEtleTpmdW5jdGlvbihleHBhbmRlZEtleSxyb3VuZEtleVBvaW50ZXIpCgkJewoJCQl2YXIgcm91bmRLZXkgPSBbXTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspCgkJCQlmb3IgKHZhciBqID0gMDsgaiA8IDQ7IGorKykKCQkJCQlyb3VuZEtleVtqKjQraV0gPSBleHBhbmRlZEtleVtyb3VuZEtleVBvaW50ZXIgKyBpKjQgKyBqXTsKCQkJcmV0dXJuIHJvdW5kS2V5OwoJCX0sCgkJCgkJLyogc3Vic3RpdHV0ZSBhbGwgdGhlIHZhbHVlcyBmcm9tIHRoZSBzdGF0ZSB3aXRoIHRoZSB2YWx1ZSBpbiB0aGUgU0JveAoJCSAqIHVzaW5nIHRoZSBzdGF0ZSB2YWx1ZSBhcyBpbmRleCBmb3IgdGhlIFNCb3gKCQkgKi8KCQlzdWJCeXRlczpmdW5jdGlvbihzdGF0ZSxpc0ludikKCQl7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCXN0YXRlW2ldID0gaXNJbnY/dGhpcy5yc2JveFtzdGF0ZVtpXV06dGhpcy5zYm94W3N0YXRlW2ldXTsKCQkJcmV0dXJuIHN0YXRlOwoJCX0sCgkJCgkJLyogaXRlcmF0ZSBvdmVyIHRoZSA0IHJvd3MgYW5kIGNhbGwgc2hpZnRSb3coKSB3aXRoIHRoYXQgcm93ICovCgkJc2hpZnRSb3dzOmZ1bmN0aW9uKHN0YXRlLGlzSW52KQoJCXsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspCgkJCQlzdGF0ZSA9IHRoaXMuc2hpZnRSb3coc3RhdGUsaSo0LCBpLGlzSW52KTsKCQkJcmV0dXJuIHN0YXRlOwoJCX0sCgkJCgkJLyogZWFjaCBpdGVyYXRpb24gc2hpZnRzIHRoZSByb3cgdG8gdGhlIGxlZnQgYnkgMSAqLwoJCXNoaWZ0Um93OmZ1bmN0aW9uKHN0YXRlLHN0YXRlUG9pbnRlcixuYnIsaXNJbnYpCgkJewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IG5icjsgaSsrKQoJCQl7CgkJCQlpZihpc0ludikKCQkJCXsKCQkJCQl2YXIgdG1wID0gc3RhdGVbc3RhdGVQb2ludGVyICsgM107CgkJCQkJZm9yICh2YXIgaiA9IDM7IGogPiAwOyBqLS0pCgkJCQkJCXN0YXRlW3N0YXRlUG9pbnRlciArIGpdID0gc3RhdGVbc3RhdGVQb2ludGVyICsgai0xXTsKCQkJCQlzdGF0ZVtzdGF0ZVBvaW50ZXJdID0gdG1wOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCXZhciB0bXAgPSBzdGF0ZVtzdGF0ZVBvaW50ZXJdOwoJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgMzsgaisrKQoJCQkJCQlzdGF0ZVtzdGF0ZVBvaW50ZXIgKyBqXSA9IHN0YXRlW3N0YXRlUG9pbnRlciArIGorMV07CgkJCQkJc3RhdGVbc3RhdGVQb2ludGVyICsgM10gPSB0bXA7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHN0YXRlOwoJCX0sCgoJCS8vIGdhbG9pcyBtdWx0aXBsaWNhdGlvbiBvZiA4IGJpdCBjaGFyYWN0ZXJzIGEgYW5kIGIKCQlnYWxvaXNfbXVsdGlwbGljYXRpb246ZnVuY3Rpb24oYSxiKQoJCXsKCQkJdmFyIHAgPSAwOwoJCQlmb3IodmFyIGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgODsgY291bnRlcisrKQoJCQl7CgkJCQlpZigoYiAmIDEpID09IDEpCgkJCQkJcCBePSBhOwoJCQkJaWYocCA+IDB4MTAwKSBwIF49IDB4MTAwOwoJCQkJdmFyIGhpX2JpdF9zZXQgPSAoYSAmIDB4ODApOyAvL2tlZXAgcCA4IGJpdAoJCQkJYSA8PD0gMTsKCQkJCWlmKGEgPiAweDEwMCkgYSBePSAweDEwMDsgLy9rZWVwIGEgOCBiaXQKCQkJCWlmKGhpX2JpdF9zZXQgPT0gMHg4MCkKCQkJCQlhIF49IDB4MWI7CgkJCQlpZihhID4gMHgxMDApIGEgXj0gMHgxMDA7IC8va2VlcCBhIDggYml0CgkJCQliID4+PSAxOwoJCQkJaWYoYiA+IDB4MTAwKSBiIF49IDB4MTAwOyAvL2tlZXAgYiA4IGJpdAoJCQl9CgkJCXJldHVybiBwOwoJCX0sCgkJCgkJLy8gZ2Fsb2lzIG11bHRpcGljYXRpb24gb2YgdGhlIDR4NCBtYXRyaXgKCQltaXhDb2x1bW5zOmZ1bmN0aW9uKHN0YXRlLGlzSW52KQoJCXsKCQkJdmFyIGNvbHVtbiA9IFtdOwoJCQkvKiBpdGVyYXRlIG92ZXIgdGhlIDQgY29sdW1ucyAqLwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykKCQkJewoJCQkJLyogY29uc3RydWN0IG9uZSBjb2x1bW4gYnkgaXRlcmF0aW5nIG92ZXIgdGhlIDQgcm93cyAqLwoJCQkJZm9yICh2YXIgaiA9IDA7IGogPCA0OyBqKyspCgkJCQkJY29sdW1uW2pdID0gc3RhdGVbKGoqNCkraV07CgkJCQkvKiBhcHBseSB0aGUgbWl4Q29sdW1uIG9uIG9uZSBjb2x1bW4gKi8KCQkJCWNvbHVtbiA9IHRoaXMubWl4Q29sdW1uKGNvbHVtbixpc0ludik7CgkJCQkvKiBwdXQgdGhlIHZhbHVlcyBiYWNrIGludG8gdGhlIHN0YXRlICovCgkJCQlmb3IgKHZhciBrID0gMDsgayA8IDQ7IGsrKykKCQkJCQlzdGF0ZVsoayo0KStpXSA9IGNvbHVtbltrXTsKCQkJfQoJCQlyZXR1cm4gc3RhdGU7CgkJfSwKCgkJLy8gZ2Fsb2lzIG11bHRpcGljYXRpb24gb2YgMSBjb2x1bW4gb2YgdGhlIDR4NCBtYXRyaXgKCQltaXhDb2x1bW46ZnVuY3Rpb24oY29sdW1uLGlzSW52KQoJCXsKCQkJdmFyIG11bHQgPSBbXTsJCgkJCWlmKGlzSW52KQoJCQkJbXVsdCA9IFsxNCw5LDEzLDExXTsKCQkJZWxzZQoJCQkJbXVsdCA9IFsyLDEsMSwzXTsKCQkJdmFyIGNweSA9IFtdOwoJCQlmb3IodmFyIGkgPSAwOyBpIDwgNDsgaSsrKQoJCQkJY3B5W2ldID0gY29sdW1uW2ldOwoJCQkKCQkJY29sdW1uWzBdID0gCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVswXSxtdWx0WzBdKSBeCgkJCQkJdGhpcy5nYWxvaXNfbXVsdGlwbGljYXRpb24oY3B5WzNdLG11bHRbMV0pIF4KCQkJCQl0aGlzLmdhbG9pc19tdWx0aXBsaWNhdGlvbihjcHlbMl0sbXVsdFsyXSkgXgoJCQkJCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVsxXSxtdWx0WzNdKTsKCQkJY29sdW1uWzFdID0gCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVsxXSxtdWx0WzBdKSBeCgkJCQkJdGhpcy5nYWxvaXNfbXVsdGlwbGljYXRpb24oY3B5WzBdLG11bHRbMV0pIF4KCQkJCQl0aGlzLmdhbG9pc19tdWx0aXBsaWNhdGlvbihjcHlbM10sbXVsdFsyXSkgXgoJCQkJCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVsyXSxtdWx0WzNdKTsKCQkJY29sdW1uWzJdID0gCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVsyXSxtdWx0WzBdKSBeCgkJCQkJdGhpcy5nYWxvaXNfbXVsdGlwbGljYXRpb24oY3B5WzFdLG11bHRbMV0pIF4KCQkJCQl0aGlzLmdhbG9pc19tdWx0aXBsaWNhdGlvbihjcHlbMF0sbXVsdFsyXSkgXgoJCQkJCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVszXSxtdWx0WzNdKTsKCQkJY29sdW1uWzNdID0gCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVszXSxtdWx0WzBdKSBeCgkJCQkJdGhpcy5nYWxvaXNfbXVsdGlwbGljYXRpb24oY3B5WzJdLG11bHRbMV0pIF4KCQkJCQl0aGlzLmdhbG9pc19tdWx0aXBsaWNhdGlvbihjcHlbMV0sbXVsdFsyXSkgXgoJCQkJCXRoaXMuZ2Fsb2lzX211bHRpcGxpY2F0aW9uKGNweVswXSxtdWx0WzNdKTsKCQkJcmV0dXJuIGNvbHVtbjsKCQl9LAoJCQoJCS8vIGFwcGxpZXMgdGhlIDQgb3BlcmF0aW9ucyBvZiB0aGUgZm9yd2FyZCByb3VuZCBpbiBzZXF1ZW5jZQoJCXJvdW5kOmZ1bmN0aW9uKHN0YXRlLCByb3VuZEtleSkKCQl7CgkJCXN0YXRlID0gdGhpcy5zdWJCeXRlcyhzdGF0ZSxmYWxzZSk7CgkJCXN0YXRlID0gdGhpcy5zaGlmdFJvd3Moc3RhdGUsZmFsc2UpOwoJCQlzdGF0ZSA9IHRoaXMubWl4Q29sdW1ucyhzdGF0ZSxmYWxzZSk7CgkJCXN0YXRlID0gdGhpcy5hZGRSb3VuZEtleShzdGF0ZSwgcm91bmRLZXkpOwoJCQlyZXR1cm4gc3RhdGU7CgkJfSwKCQkKCQkvLyBhcHBsaWVzIHRoZSA0IG9wZXJhdGlvbnMgb2YgdGhlIGludmVyc2Ugcm91bmQgaW4gc2VxdWVuY2UKCQlpbnZSb3VuZDpmdW5jdGlvbihzdGF0ZSxyb3VuZEtleSkKCQl7CgkJCXN0YXRlID0gdGhpcy5zaGlmdFJvd3Moc3RhdGUsdHJ1ZSk7CgkJCXN0YXRlID0gdGhpcy5zdWJCeXRlcyhzdGF0ZSx0cnVlKTsKCQkJc3RhdGUgPSB0aGlzLmFkZFJvdW5kS2V5KHN0YXRlLCByb3VuZEtleSk7CgkJCXN0YXRlID0gdGhpcy5taXhDb2x1bW5zKHN0YXRlLHRydWUpOwoJCQlyZXR1cm4gc3RhdGU7CgkJfSwKCQkKCQkvKgoJCSAqIFBlcmZvcm0gdGhlIGluaXRpYWwgb3BlcmF0aW9ucywgdGhlIHN0YW5kYXJkIHJvdW5kLCBhbmQgdGhlIGZpbmFsIG9wZXJhdGlvbnMKCQkgKiBvZiB0aGUgZm9yd2FyZCBhZXMsIGNyZWF0aW5nIGEgcm91bmQga2V5IGZvciBlYWNoIHJvdW5kCgkJICovCgkJbWFpbjpmdW5jdGlvbihzdGF0ZSxleHBhbmRlZEtleSxuYnJSb3VuZHMpCgkJewoJCQlzdGF0ZSA9IHRoaXMuYWRkUm91bmRLZXkoc3RhdGUsIHRoaXMuY3JlYXRlUm91bmRLZXkoZXhwYW5kZWRLZXksMCkpOwoJCQlmb3IgKHZhciBpID0gMTsgaSA8IG5iclJvdW5kczsgaSsrKQoJCQkJc3RhdGUgPSB0aGlzLnJvdW5kKHN0YXRlLCB0aGlzLmNyZWF0ZVJvdW5kS2V5KGV4cGFuZGVkS2V5LDE2KmkpKTsKCQkJc3RhdGUgPSB0aGlzLnN1YkJ5dGVzKHN0YXRlLGZhbHNlKTsKCQkJc3RhdGUgPSB0aGlzLnNoaWZ0Um93cyhzdGF0ZSxmYWxzZSk7CgkJCXN0YXRlID0gdGhpcy5hZGRSb3VuZEtleShzdGF0ZSwgdGhpcy5jcmVhdGVSb3VuZEtleShleHBhbmRlZEtleSwxNipuYnJSb3VuZHMpKTsKCQkJcmV0dXJuIHN0YXRlOwoJCX0sCgkJCgkJLyoKCQkgKiBQZXJmb3JtIHRoZSBpbml0aWFsIG9wZXJhdGlvbnMsIHRoZSBzdGFuZGFyZCByb3VuZCwgYW5kIHRoZSBmaW5hbCBvcGVyYXRpb25zCgkJICogb2YgdGhlIGludmVyc2UgYWVzLCBjcmVhdGluZyBhIHJvdW5kIGtleSBmb3IgZWFjaCByb3VuZAoJCSAqLwoJCWludk1haW46ZnVuY3Rpb24oc3RhdGUsIGV4cGFuZGVkS2V5LCBuYnJSb3VuZHMpCgkJewoJCQlzdGF0ZSA9IHRoaXMuYWRkUm91bmRLZXkoc3RhdGUsIHRoaXMuY3JlYXRlUm91bmRLZXkoZXhwYW5kZWRLZXksMTYqbmJyUm91bmRzKSk7CgkJCWZvciAodmFyIGkgPSBuYnJSb3VuZHMtMTsgaSA+IDA7IGktLSkKCQkJCXN0YXRlID0gdGhpcy5pbnZSb3VuZChzdGF0ZSwgdGhpcy5jcmVhdGVSb3VuZEtleShleHBhbmRlZEtleSwxNippKSk7CgkJCXN0YXRlID0gdGhpcy5zaGlmdFJvd3Moc3RhdGUsdHJ1ZSk7CgkJCXN0YXRlID0gdGhpcy5zdWJCeXRlcyhzdGF0ZSx0cnVlKTsKCQkJc3RhdGUgPSB0aGlzLmFkZFJvdW5kS2V5KHN0YXRlLCB0aGlzLmNyZWF0ZVJvdW5kS2V5KGV4cGFuZGVkS2V5LDApKTsKCQkJcmV0dXJuIHN0YXRlOwoJCX0sCgoJCW51bWJlck9mUm91bmRzOmZ1bmN0aW9uKHNpemUpCgkJewoJCQl2YXIgbmJyUm91bmRzOwoJCQlzd2l0Y2ggKHNpemUpIC8qIHNldCB0aGUgbnVtYmVyIG9mIHJvdW5kcyAqLwoJCQl7CgkJCQljYXNlIHRoaXMua2V5U2l6ZS5TSVpFXzEyODoKCQkJCQluYnJSb3VuZHMgPSAxMDsKCQkJCQlicmVhazsKCQkJCWNhc2UgdGhpcy5rZXlTaXplLlNJWkVfMTkyOgoJCQkJCW5iclJvdW5kcyA9IDEyOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSB0aGlzLmtleVNpemUuU0laRV8yNTY6CgkJCQkJbmJyUm91bmRzID0gMTQ7CgkJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCXJldHVybiBudWxsOwoJCQkJCWJyZWFrOwoJCQl9CgkJCXJldHVybiBuYnJSb3VuZHM7CgkJfSwKCQkKCQkvLyBlbmNyeXB0cyBhIDEyOCBiaXQgaW5wdXQgYmxvY2sgYWdhaW5zdCB0aGUgZ2l2ZW4ga2V5IG9mIHNpemUgc3BlY2lmaWVkCgkJZW5jcnlwdDpmdW5jdGlvbihpbnB1dCxrZXksc2l6ZSkKCQl7CgkJCXZhciBvdXRwdXQgPSBbXTsKCQkJdmFyIGJsb2NrID0gW107IC8qIHRoZSAxMjggYml0IGJsb2NrIHRvIGVuY29kZSAqLwoJCQl2YXIgbmJyUm91bmRzID0gdGhpcy5udW1iZXJPZlJvdW5kcyhzaXplKTsKCQkJLyogU2V0IHRoZSBibG9jayB2YWx1ZXMsIGZvciB0aGUgYmxvY2s6CgkJCSAqIGEwLDAgYTAsMSBhMCwyIGEwLDMKCQkJICogYTEsMCBhMSwxIGExLDIgYTEsMwoJCQkgKiBhMiwwIGEyLDEgYTIsMiBhMiwzCgkJCSAqIGEzLDAgYTMsMSBhMywyIGEzLDMKCQkJICogdGhlIG1hcHBpbmcgb3JkZXIgaXMgYTAsMCBhMSwwIGEyLDAgYTMsMCBhMCwxIGExLDEgLi4uIGEyLDMgYTMsMwoJCQkgKi8KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIC8qIGl0ZXJhdGUgb3ZlciB0aGUgY29sdW1ucyAqLwoJCQkJZm9yICh2YXIgaiA9IDA7IGogPCA0OyBqKyspIC8qIGl0ZXJhdGUgb3ZlciB0aGUgcm93cyAqLwoJCQkJCWJsb2NrWyhpKyhqKjQpKV0gPSBpbnB1dFsoaSo0KStqXTsKCQkKCQkJLyogZXhwYW5kIHRoZSBrZXkgaW50byBhbiAxNzYsIDIwOCwgMjQwIGJ5dGVzIGtleSAqLwoJCQl2YXIgZXhwYW5kZWRLZXkgPSB0aGlzLmV4cGFuZEtleShrZXksIHNpemUpOyAvKiB0aGUgZXhwYW5kZWQga2V5ICovCgkJCS8qIGVuY3J5cHQgdGhlIGJsb2NrIHVzaW5nIHRoZSBleHBhbmRlZEtleSAqLwoJCQlibG9jayA9IHRoaXMubWFpbihibG9jaywgZXhwYW5kZWRLZXksIG5iclJvdW5kcyk7CgkJCWZvciAodmFyIGsgPSAwOyBrIDwgNDsgaysrKSAvKiB1bm1hcCB0aGUgYmxvY2sgYWdhaW4gaW50byB0aGUgb3V0cHV0ICovCgkJCQlmb3IgKHZhciBsID0gMDsgbCA8IDQ7IGwrKykgLyogaXRlcmF0ZSBvdmVyIHRoZSByb3dzICovCgkJCQkJb3V0cHV0WyhrKjQpK2xdID0gYmxvY2tbKGsrKGwqNCkpXTsKCQkJcmV0dXJuIG91dHB1dDsKCQl9LAoJCQoJCS8vIGRlY3J5cHRzIGEgMTI4IGJpdCBpbnB1dCBibG9jayBhZ2FpbnN0IHRoZSBnaXZlbiBrZXkgb2Ygc2l6ZSBzcGVjaWZpZWQKCQlkZWNyeXB0OmZ1bmN0aW9uKGlucHV0LCBrZXksIHNpemUpCgkJewoJCQl2YXIgb3V0cHV0ID0gW107CgkJCXZhciBibG9jayA9IFtdOyAvKiB0aGUgMTI4IGJpdCBibG9jayB0byBkZWNvZGUgKi8KCQkJdmFyIG5iclJvdW5kcyA9IHRoaXMubnVtYmVyT2ZSb3VuZHMoc2l6ZSk7CgkJCS8qIFNldCB0aGUgYmxvY2sgdmFsdWVzLCBmb3IgdGhlIGJsb2NrOgoJCQkgKiBhMCwwIGEwLDEgYTAsMiBhMCwzCgkJCSAqIGExLDAgYTEsMSBhMSwyIGExLDMKCQkJICogYTIsMCBhMiwxIGEyLDIgYTIsMwoJCQkgKiBhMywwIGEzLDEgYTMsMiBhMywzCgkJCSAqIHRoZSBtYXBwaW5nIG9yZGVyIGlzIGEwLDAgYTEsMCBhMiwwIGEzLDAgYTAsMSBhMSwxIC4uLiBhMiwzIGEzLDMKCQkJICovCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSAvKiBpdGVyYXRlIG92ZXIgdGhlIGNvbHVtbnMgKi8KCQkJCWZvciAodmFyIGogPSAwOyBqIDwgNDsgaisrKSAvKiBpdGVyYXRlIG92ZXIgdGhlIHJvd3MgKi8KCQkJCQlibG9ja1soaSsoaio0KSldID0gaW5wdXRbKGkqNCkral07CgkJCS8qIGV4cGFuZCB0aGUga2V5IGludG8gYW4gMTc2LCAyMDgsIDI0MCBieXRlcyBrZXkgKi8KCQkJdmFyIGV4cGFuZGVkS2V5ID0gdGhpcy5leHBhbmRLZXkoa2V5LCBzaXplKTsKCQkJLyogZGVjcnlwdCB0aGUgYmxvY2sgdXNpbmcgdGhlIGV4cGFuZGVkS2V5ICovCgkJCWJsb2NrID0gdGhpcy5pbnZNYWluKGJsb2NrLCBleHBhbmRlZEtleSwgbmJyUm91bmRzKTsKCQkJZm9yICh2YXIgayA9IDA7IGsgPCA0OyBrKyspLyogdW5tYXAgdGhlIGJsb2NrIGFnYWluIGludG8gdGhlIG91dHB1dCAqLwoJCQkJZm9yICh2YXIgbCA9IDA7IGwgPCA0OyBsKyspLyogaXRlcmF0ZSBvdmVyIHRoZSByb3dzICovCgkJCQkJb3V0cHV0WyhrKjQpK2xdID0gYmxvY2tbKGsrKGwqNCkpXTsKCQkJcmV0dXJuIG91dHB1dDsKCQl9Cgl9LAoJLyoKCSAqIEVORCBBRVMgU0VDVElPTgoJICovCgkgCgkvKgoJICogU1RBUlQgTU9ERSBPRiBPUEVSQVRJT04gU0VDVElPTgoJICovCgkvL3N0cnVjdHVyZSBvZiBzdXBwb3J0ZWQgbW9kZXMgb2Ygb3BlcmF0aW9uCgltb2RlT2ZPcGVyYXRpb246ewoJCU9GQjowLAoJCUNGQjoxLAoJCUNCQzoyCgl9LAoJCgkvLyBnZXQgYSAxNiBieXRlIGJsb2NrIChhZXMgb3BlcmF0ZXMgb24gMTI4Yml0cykKCWdldEJsb2NrOiBmdW5jdGlvbihieXRlc0luLHN0YXJ0LGVuZCxtb2RlKQoJewoJCWlmKGVuZCAtIHN0YXJ0ID4gMTYpCgkJCWVuZCA9IHN0YXJ0ICsgMTY7CgkJCgkJcmV0dXJuIGJ5dGVzSW4uc2xpY2Uoc3RhcnQsIGVuZCk7Cgl9LAoJCgkvKgoJICogTW9kZSBvZiBPcGVyYXRpb24gRW5jcnlwdGlvbgoJICogYnl0ZXNJbiAtIElucHV0IFN0cmluZyBhcyBhcnJheSBvZiBieXRlcwoJICogbW9kZSAtIG1vZGUgb2YgdHlwZSBtb2RlT2ZPcGVyYXRpb24KCSAqIGtleSAtIGEgbnVtYmVyIGFycmF5IG9mIGxlbmd0aCAnc2l6ZScKCSAqIHNpemUgLSB0aGUgYml0IGxlbmd0aCBvZiB0aGUga2V5CgkgKiBpdiAtIHRoZSAxMjggYml0IG51bWJlciBhcnJheSBJbml0aWFsaXphdGlvbiBWZWN0b3IKCSAqLwoJZW5jcnlwdDogZnVuY3Rpb24gKGJ5dGVzSW4sIG1vZGUsIGtleSwgaXYpCgl7CgkJdmFyIHNpemUgPSBrZXkubGVuZ3RoOwoJCWlmKGl2Lmxlbmd0aCUxNikKCQl7CgkJCXRocm93ICdpdiBsZW5ndGggbXVzdCBiZSAxMjggYml0cy4nOwoJCX0KCQkvLyB0aGUgQUVTIGlucHV0L291dHB1dAoJCXZhciBieXRlQXJyYXkgPSBbXTsKCQl2YXIgaW5wdXQgPSBbXTsKCQl2YXIgb3V0cHV0ID0gW107CgkJdmFyIGNpcGhlcnRleHQgPSBbXTsKCQl2YXIgY2lwaGVyT3V0ID0gW107CgkJLy8gY2hhciBmaXJzdFJvdW5kCgkJdmFyIGZpcnN0Um91bmQgPSB0cnVlOwoJCWlmIChtb2RlID09IHRoaXMubW9kZU9mT3BlcmF0aW9uLkNCQykKCQkJdGhpcy5wYWRCeXRlc0luKGJ5dGVzSW4pOwoJCWlmIChieXRlc0luICE9PSBudWxsKQoJCXsKCQkJZm9yICh2YXIgaiA9IDA7aiA8IE1hdGguY2VpbChieXRlc0luLmxlbmd0aC8xNik7IGorKykKCQkJewoJCQkJdmFyIHN0YXJ0ID0gaioxNjsKCQkJCXZhciBlbmQgPSBqKjE2KzE2OwoJCQkJaWYoaioxNisxNiA+IGJ5dGVzSW4ubGVuZ3RoKQoJCQkJCWVuZCA9IGJ5dGVzSW4ubGVuZ3RoOwoJCQkJYnl0ZUFycmF5ID0gdGhpcy5nZXRCbG9jayhieXRlc0luLHN0YXJ0LGVuZCxtb2RlKTsKCQkJCWlmIChtb2RlID09IHRoaXMubW9kZU9mT3BlcmF0aW9uLkNGQikKCQkJCXsKCQkJCQlpZiAoZmlyc3RSb3VuZCkKCQkJCQl7CgkJCQkJCW91dHB1dCA9IHRoaXMuYWVzLmVuY3J5cHQoaXYsIGtleSwgc2l6ZSk7CgkJCQkJCWZpcnN0Um91bmQgPSBmYWxzZTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCQlvdXRwdXQgPSB0aGlzLmFlcy5lbmNyeXB0KGlucHV0LCBrZXksIHNpemUpOwoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCQkJY2lwaGVydGV4dFtpXSA9IGJ5dGVBcnJheVtpXSBeIG91dHB1dFtpXTsKCQkJCQlmb3IodmFyIGsgPSAwO2sgPCBlbmQtc3RhcnQ7aysrKQoJCQkJCQljaXBoZXJPdXQucHVzaChjaXBoZXJ0ZXh0W2tdKTsKCQkJCQlpbnB1dCA9IGNpcGhlcnRleHQ7CgkJCQl9CgkJCQllbHNlIGlmIChtb2RlID09IHRoaXMubW9kZU9mT3BlcmF0aW9uLk9GQikKCQkJCXsKCQkJCQlpZiAoZmlyc3RSb3VuZCkKCQkJCQl7CgkJCQkJCW91dHB1dCA9IHRoaXMuYWVzLmVuY3J5cHQoaXYsIGtleSwgc2l6ZSk7CgkJCQkJCWZpcnN0Um91bmQgPSBmYWxzZTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCQlvdXRwdXQgPSB0aGlzLmFlcy5lbmNyeXB0KGlucHV0LCBrZXksIHNpemUpOwoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCQkJY2lwaGVydGV4dFtpXSA9IGJ5dGVBcnJheVtpXSBeIG91dHB1dFtpXTsKCQkJCQlmb3IodmFyIGsgPSAwO2sgPCBlbmQtc3RhcnQ7aysrKQoJCQkJCQljaXBoZXJPdXQucHVzaChjaXBoZXJ0ZXh0W2tdKTsKCQkJCQlpbnB1dCA9IG91dHB1dDsKCQkJCX0KCQkJCWVsc2UgaWYgKG1vZGUgPT0gdGhpcy5tb2RlT2ZPcGVyYXRpb24uQ0JDKQoJCQkJewoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCQkJaW5wdXRbaV0gPSBieXRlQXJyYXlbaV0gXiAoKGZpcnN0Um91bmQpID8gaXZbaV0gOiBjaXBoZXJ0ZXh0W2ldKTsKCQkJCQlmaXJzdFJvdW5kID0gZmFsc2U7CgkJCQkJY2lwaGVydGV4dCA9IHRoaXMuYWVzLmVuY3J5cHQoaW5wdXQsIGtleSwgc2l6ZSk7CgkJCQkJLy8gYWx3YXlzIDE2IGJ5dGVzIGJlY2F1c2Ugb2YgdGhlIHBhZGRpbmcgZm9yIENCQwoJCQkJCWZvcih2YXIgayA9IDA7ayA8IDE2O2srKykKCQkJCQkJY2lwaGVyT3V0LnB1c2goY2lwaGVydGV4dFtrXSk7CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIGNpcGhlck91dDsKCX0sCgkKCS8qCgkgKiBNb2RlIG9mIE9wZXJhdGlvbiBEZWNyeXB0aW9uCgkgKiBjaXBoZXJJbiAtIEVuY3J5cHRlZCBTdHJpbmcgYXMgYXJyYXkgb2YgYnl0ZXMKCSAqIG9yaWdpbmFsc2l6ZSAtIFRoZSB1bmVuY3J5cHRlZCBzdHJpbmcgbGVuZ3RoIC0gcmVxdWlyZWQgZm9yIENCQwoJICogbW9kZSAtIG1vZGUgb2YgdHlwZSBtb2RlT2ZPcGVyYXRpb24KCSAqIGtleSAtIGEgbnVtYmVyIGFycmF5IG9mIGxlbmd0aCAnc2l6ZScKCSAqIHNpemUgLSB0aGUgYml0IGxlbmd0aCBvZiB0aGUga2V5CgkgKiBpdiAtIHRoZSAxMjggYml0IG51bWJlciBhcnJheSBJbml0aWFsaXphdGlvbiBWZWN0b3IKCSAqLwoJZGVjcnlwdDpmdW5jdGlvbihjaXBoZXJJbixtb2RlLGtleSxpdikKCXsKCQl2YXIgc2l6ZSA9IGtleS5sZW5ndGg7CgkJaWYoaXYubGVuZ3RoJTE2KQoJCXsKCQkJdGhyb3cgJ2l2IGxlbmd0aCBtdXN0IGJlIDEyOCBiaXRzLic7CgkJfQoJCS8vIHRoZSBBRVMgaW5wdXQvb3V0cHV0CgkJdmFyIGNpcGhlcnRleHQgPSBbXTsKCQl2YXIgaW5wdXQgPSBbXTsKCQl2YXIgb3V0cHV0ID0gW107CgkJdmFyIGJ5dGVBcnJheSA9IFtdOwoJCXZhciBieXRlc091dCA9IFtdOwoJCS8vIGNoYXIgZmlyc3RSb3VuZAoJCXZhciBmaXJzdFJvdW5kID0gdHJ1ZTsKCQlpZiAoY2lwaGVySW4gIT09IG51bGwpCgkJewoJCQlmb3IgKHZhciBqID0gMDtqIDwgTWF0aC5jZWlsKGNpcGhlckluLmxlbmd0aC8xNik7IGorKykKCQkJewoJCQkJdmFyIHN0YXJ0ID0gaioxNjsKCQkJCXZhciBlbmQgPSBqKjE2KzE2OwoJCQkJaWYoaioxNisxNiA+IGNpcGhlckluLmxlbmd0aCkKCQkJCQllbmQgPSBjaXBoZXJJbi5sZW5ndGg7CgkJCQljaXBoZXJ0ZXh0ID0gdGhpcy5nZXRCbG9jayhjaXBoZXJJbixzdGFydCxlbmQsbW9kZSk7CgkJCQlpZiAobW9kZSA9PSB0aGlzLm1vZGVPZk9wZXJhdGlvbi5DRkIpCgkJCQl7CgkJCQkJaWYgKGZpcnN0Um91bmQpCgkJCQkJewoJCQkJCQlvdXRwdXQgPSB0aGlzLmFlcy5lbmNyeXB0KGl2LCBrZXksIHNpemUpOwoJCQkJCQlmaXJzdFJvdW5kID0gZmFsc2U7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQkJb3V0cHV0ID0gdGhpcy5hZXMuZW5jcnlwdChpbnB1dCwga2V5LCBzaXplKTsKCQkJCQlmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCQkJYnl0ZUFycmF5W2ldID0gb3V0cHV0W2ldIF4gY2lwaGVydGV4dFtpXTsKCQkJCQlmb3IodmFyIGsgPSAwO2sgPCBlbmQtc3RhcnQ7aysrKQoJCQkJCQlieXRlc091dC5wdXNoKGJ5dGVBcnJheVtrXSk7CgkJCQkJaW5wdXQgPSBjaXBoZXJ0ZXh0OwoJCQkJfQoJCQkJZWxzZSBpZiAobW9kZSA9PSB0aGlzLm1vZGVPZk9wZXJhdGlvbi5PRkIpCgkJCQl7CgkJCQkJaWYgKGZpcnN0Um91bmQpCgkJCQkJewoJCQkJCQlvdXRwdXQgPSB0aGlzLmFlcy5lbmNyeXB0KGl2LCBrZXksIHNpemUpOwoJCQkJCQlmaXJzdFJvdW5kID0gZmFsc2U7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQkJb3V0cHV0ID0gdGhpcy5hZXMuZW5jcnlwdChpbnB1dCwga2V5LCBzaXplKTsKCQkJCQlmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCQkJYnl0ZUFycmF5W2ldID0gb3V0cHV0W2ldIF4gY2lwaGVydGV4dFtpXTsKCQkJCQlmb3IodmFyIGsgPSAwO2sgPCBlbmQtc3RhcnQ7aysrKQoJCQkJCQlieXRlc091dC5wdXNoKGJ5dGVBcnJheVtrXSk7CgkJCQkJaW5wdXQgPSBvdXRwdXQ7CgkJCQl9CgkJCQllbHNlIGlmKG1vZGUgPT0gdGhpcy5tb2RlT2ZPcGVyYXRpb24uQ0JDKQoJCQkJewoJCQkJCW91dHB1dCA9IHRoaXMuYWVzLmRlY3J5cHQoY2lwaGVydGV4dCwga2V5LCBzaXplKTsKCQkJCQlmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykKCQkJCQkJYnl0ZUFycmF5W2ldID0gKChmaXJzdFJvdW5kKSA/IGl2W2ldIDogaW5wdXRbaV0pIF4gb3V0cHV0W2ldOwoJCQkJCWZpcnN0Um91bmQgPSBmYWxzZTsKCQkJCQlmb3IodmFyIGsgPSAwO2sgPCBlbmQtc3RhcnQ7aysrKQoJCQkJCQlieXRlc091dC5wdXNoKGJ5dGVBcnJheVtrXSk7CgkJCQkJaW5wdXQgPSBjaXBoZXJ0ZXh0OwoJCQkJfQoJCQl9CgkJCWlmKG1vZGUgPT0gdGhpcy5tb2RlT2ZPcGVyYXRpb24uQ0JDKQoJCQkgICAgdGhpcy51bnBhZEJ5dGVzT3V0KGJ5dGVzT3V0KTsKCQl9CgkJcmV0dXJuIGJ5dGVzT3V0OwoJfSwKCXBhZEJ5dGVzSW46IGZ1bmN0aW9uKGRhdGEpIHsKCQl2YXIgbGVuID0gZGF0YS5sZW5ndGg7CgkJdmFyIHBhZEJ5dGUgPSAxNiAtIChsZW4gJSAxNik7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBwYWRCeXRlOyBpKyspIHsKCQkJZGF0YS5wdXNoKHBhZEJ5dGUpOwoJCX0KCX0sCgl1bnBhZEJ5dGVzT3V0OiBmdW5jdGlvbihkYXRhKSB7CgkJdmFyIHBhZENvdW50ID0gMDsKCQl2YXIgcGFkQnl0ZSA9IC0xOwoJCXZhciBibG9ja1NpemUgPSAxNjsKCQlmb3IgKHZhciBpID0gZGF0YS5sZW5ndGggLSAxOyBpID49IGRhdGEubGVuZ3RoLTEgLSBibG9ja1NpemU7IGktLSkgewoJCQlpZiAoZGF0YVtpXSA8PSBibG9ja1NpemUpIHsKCQkJCWlmIChwYWRCeXRlID09IC0xKQoJCQkJCXBhZEJ5dGUgPSBkYXRhW2ldOwoJCQkJaWYgKGRhdGFbaV0gIT0gcGFkQnl0ZSkgewoJCQkJCXBhZENvdW50ID0gMDsKCQkJCQlicmVhazsKCQkJCX0KCQkJCXBhZENvdW50Kys7CgkJCX0gZWxzZQoJCQkJYnJlYWs7CgkJCWlmIChwYWRDb3VudCA9PSBwYWRCeXRlKQoJCQkJYnJlYWs7CgkJfQoJCWlmIChwYWRDb3VudCA+IDApCgkJCWRhdGEuc3BsaWNlKGRhdGEubGVuZ3RoIC0gcGFkQ291bnQsIHBhZENvdW50KTsKCX0KCS8qCgkgKiBFTkQgTU9ERSBPRiBPUEVSQVRJT04gU0VDVElPTgoJICovCn07Cg==" />
<script>
var init_vector = "1234567890123456";
function decrypt_message(form) {
	var password = form.password.value;
	var cleartext = slowAES.decrypt(ciphertext,
									slowAES.modeOfOperation.CFB,
									password,
									init_vector);
	var old = document.getElementById("old_message");
	
	var str = "";
	for(var i in cleartext) {
		str += String.fromCharCode(cleartext[i]);
	}
	
	old.innerHTML = str;
	return false;
};
function encrypt_message(form) {
	var message = form.message.value;
	var password = form.password.value;
	
	var byte_list = [];
	for(var i in message) {
		var code = message.charCodeAt(i);
		byte_list.push(code);
	}
	
	var ciphertext = slowAES.encrypt(byte_list,
									slowAES.modeOfOperation.CFB,
									password,
									init_vector);

	var hidden_text = "XXXXXX SECURED MESSAGE XXXXXX";
	document.getElementById("old_message").innerHTML = hidden_text;
	document.getElementById("opassword").value = "password";
	document.getElementById("npassword").value = "password";
	document.getElementById("message").value = "";
	document.getElementById("download_link").innerHTML = "";
	
	var whole_source = new XMLSerializer().serializeToString(document);
	
	var troublesome_find_text = "];//ENDCIPHERTEXT";
	
	var first_part = whole_source.split("var ciphertext = [")[0];
	var parts = whole_source.split(troublesome_find_text);
	var second_part = parts[1]+troublesome_find_text+parts[2];
	
	var new_html = first_part + "var ciphertext = [";
	new_html += ciphertext.toString();
	new_html += troublesome_find_text + second_part;
	
	var link = document.createElement('a');
	link.setAttribute("href", "data:text/html," + encodeURIComponent(new_html));
	link.setAttribute("download", "signet.html");
	link.appendChild(document.createTextNode("Click here to download secure document."));
	var link_area = document.getElementById("download_link");
	link_area.appendChild(link);
	
	return false;
};
function load_aes() {
	var aes_b64 = document.getElementById("aes_data").value;
	var aes_text = atob(aes_b64);
	
	var aes_script = document.createElement('script');
	aes_script.innerHTML = aes_text;
	document.body.appendChild(aes_script)
	aes_script.parentNode.removeChild(aes_script);
};
</script>
</body></html>